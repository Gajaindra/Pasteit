<script>
    function toggleTheme() {
        document.body.classList.toggle("dark");
    }

    let debounceTimer;

    function autoSubmitNote() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
            const content = document.querySelector('textarea[name="content"]').value;

            fetch('/save', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams({ content: content })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('token').textContent = data.token;
            });
        }, 1000); // Wait 1 second after typing
    }

    function pollForUpdates() {
        fetch('/get_content')
            .then(response => response.json())
            .then(data => {
                const textarea = document.querySelector('textarea[name="content"]');
                if (textarea.value !== data.content) {
                    textarea.value = data.content;
                }
                if (data.token) {
                    document.getElementById('token').textContent = data.token;
                }
            });
    }

    setInterval(pollForUpdates, 2000); // Check every 2 seconds
</script>
